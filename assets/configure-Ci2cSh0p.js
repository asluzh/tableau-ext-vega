import{l as s}from"./logger-BsSFQCdm.js";import{r as c,j as e,t as u,l as f,c as k}from"./vendor-CAmHtlJc.js";function J(t){const[o,d]=c.useState(t.sheet);c.useEffect(()=>{s.debug("useEffect props",t),d(t.sheet)},[t]);function g(l){d(l.target.value),t.updateSheet(l.target.value)}return e.jsx("div",{style:{marginTop:20,marginBottom:20},children:e.jsxs(u.DropdownSelect,{kind:"outline",label:"Select Data Source Sheet",value:o,onChange:g,style:o?{}:{border:"1px solid red"},children:[e.jsx("option",{value:"",children:" -- Please select -- "},""),t.sheets.map(l=>e.jsx("option",{value:l.name,children:l.name},l.name))]})})}function I(t){const[o,d]=c.useState(t.spec),g=c.useMemo(()=>{try{f.parse(o.replace(/(\r|\n)/g,""))}catch(r){return`Invalid input: ${r.message}`}return"Valid input"},[o]);function l(r){d(r.target.value),t.updateJsonSpec(r.target.value)}async function h(r){try{let m=f.parse(o.replace(/(\r|\n)/g,"")),i=null;r.target.name==="json5"?i=f.stringify(m,null,2):i=JSON.stringify(m,null,2),d(i),t.updateJsonSpec(i)}catch(m){s.error("Error in JSON:",m.message)}}return e.jsxs("div",{style:{marginTop:20,marginBottom:20},children:[e.jsx(u.TextArea,{style:{width:"530px",height:"350px",whiteSpace:"pre-wrap",fontFamily:"monospace"},spellCheck:!1,wrap:"off",label:"Vega/Vega-Lite Specification",value:o,message:g,placeholder:"Enter your Vega or Vega-Lite specification here in JSON5 format",onChange:l,valid:g==="Valid input"}),e.jsx(u.Button,{className:"actionButton",kind:"outline",density:"high",onClick:h,name:"json",children:"Format JSON"}),e.jsx(u.Button,{className:"actionButton",kind:"outline",density:"high",onClick:h,name:"json5",children:"Format JSON5"})]})}function T(t){const[o,d]=c.useState(t.options),g=c.useMemo(()=>{try{f.parse(o.replace(/(\r|\n)/g,""))}catch(r){return`Invalid input: ${r.message}`}return"Valid input"},[o]);function l(r){d(r.target.value),t.updateEmbedOptions(r.target.value)}async function h(r){try{let m=f.parse(o.replace(/(\r|\n)/g,"")),i=null;r.target.name==="json5"?i=f.stringify(m,null,2):i=JSON.stringify(m,null,2),d(i),t.updateEmbedOptions(i)}catch(m){s.error("Error in JSON:",m.message)}}return e.jsxs("div",{style:{marginTop:20,marginBottom:20},children:[e.jsx(u.TextArea,{style:{width:"530px",height:"350px",whiteSpace:"pre-wrap",fontFamily:"monospace"},spellCheck:!1,wrap:"off",label:"Vega-Embed Options",value:o,message:g,placeholder:"Enter Vega-Embed options here in JSON5 format",onChange:l,valid:g==="Valid input"}),e.jsx(u.Button,{className:"actionButton",kind:"outline",density:"high",onClick:h,name:"json",children:"Format JSON"}),e.jsx(u.Button,{className:"actionButton",kind:"outline",density:"high",onClick:h,name:"json5",children:"Format JSON5"})]})}function F(t){const[o,d]=c.useState(t.mainDivStyle);function g(l){d(l.target.value),t.updateStylingOptions({mainDivStyle:l.target.value})}return e.jsx("div",{style:{marginTop:20,marginBottom:20},children:e.jsx(u.TextArea,{style:{width:"530px",height:"50px",whiteSpace:"pre",fontFamily:"monospace"},spellCheck:!1,wrap:"off",label:"Main Div Style (CSS format)",value:o,placeholder:"Enter CSS-style for main DIV element",onChange:g})})}const x=1,b={sheet:"",listenerDataChanged:"",jsonSpec:"{}",embedOptions:'{ "actions": false, "config": {} }',mainDivStyle:"width: 100vw; height: 100vh;"};function A(){const[t,o]=c.useState(0),[d,g]=c.useState([]),[l,h]=c.useState(!0),[r,m]=c.useState(!1),[i,p]=c.useState(b);c.useEffect(()=>(s.debug("useEffect"),tableau.extensions.initializeDialogAsync().then(n=>{s.debug("initializeDialogAsync completed",n),s.debug("Tableau environment:",tableau.extensions.environment.tableauVersion),m(tableau.extensions.environment.tableauVersion&&tableau.extensions.environment.tableauVersion>="2024"),g(tableau.extensions.dashboardContent.dashboard.worksheets);const a=tableau.extensions.settings.getAll();if(Object.keys(a).length>0){s.log("Existing settings found:",a);try{if("metaVersion"in a&&parseInt(a.metaVersion)){let S=parseInt(tableau.extensions.settings.get("metaVersion"));if(S>x){s.warn("Newer meta version detected in settings!");return}S<x&&s.log("Older meta version detected in saved settings, some settings may not be available");const v={...b};Object.entries(a).forEach(([j,V])=>{j in v&&(v[j]=V)}),p(v)}}catch(S){s.error("Error updating settings:",S)}}else p(b)}),()=>{s.debug("useEffect unmount")}),[]);function C(n){s.debug("updateSheet",n),p(a=>({...a,sheet:n}))}function O(n){s.debug("updateEmbedOptions",n),p(a=>({...a,embedOptions:n}))}function E(n){s.debug("updateJsonSpec",n),p(a=>({...a,jsonSpec:n}))}function D(n){s.debug("updateStylingOptions",n),p(a=>({...a,mainDivStyle:n.mainDivStyle}))}function N(){if(!i.sheet)return s.warn("Sheet variable is empty"),!1;try{f.parse(i.embedOptions.replace(/(\r|\n)/g,""))}catch(n){return s.warn("Invalid embedOptions",n),!1}try{f.parse(i.jsonSpec.replace(/(\r|\n)/g,""))}catch(n){return s.warn("Invalid jsonSpec",n),!1}return!0}function y(n){N()&&tableau.extensions.environment.mode==="authoring"&&(h(!1),tableau.extensions.settings.set("metaVersion",x),Object.entries(i).forEach(([a,S])=>{s.debug("Setting",a,"=",i[a]),tableau.extensions.settings.set(a,S)}),tableau.extensions.settings.saveAsync().then(()=>{s.debug("Settings saved"),n.target.name==="save"?tableau.extensions.ui.closeDialog("save and close"):h(!0)},a=>{window.alert("Saving settings failed! "+a.toString())}))}function w(n){tableau.extensions.ui.closeDialog("close")}function B(n){p(b),o(0)}return e.jsxs("div",{children:[e.jsx(u.Tabs,{activation:"automatic",alignment:"left",onTabChange:o,selectedTabIndex:t,tabs:[{content:"Data"},{content:"Vega Spec"},{content:"Embed Options"},{content:"Styling"}],children:e.jsxs("div",{className:"configForm",children:[t===0&&e.jsx(J,{sheets:d,sheet:i.sheet,updateSheet:C}),t===0&&e.jsx("div",{style:{marginTop:20,marginBottom:20},children:e.jsxs(u.DropdownSelect,{kind:"line",label:"Data Change Event Listener",value:i.listenerDataChanged,onChange:n=>{p(a=>({...a,listenerDataChanged:n.target.value}))},children:[e.jsx("option",{value:"",children:"None"},""),e.jsx("option",{value:"FilterChanged",children:"Filter Changed"},"FilterChanged"),e.jsx("option",{value:"SummaryDataChanged",disabled:!r,children:"Summary Data Changed"},"SummaryDataChanged")]})}),t===1&&e.jsx(I,{spec:i.jsonSpec,updateJsonSpec:E}),t===2&&e.jsx(T,{options:i.embedOptions,updateEmbedOptions:O}),t===3&&e.jsx(F,{mainDivStyle:i.mainDivStyle,updateStylingOptions:D})]})}),e.jsxs("div",{style:{bottom:20,right:20,position:"fixed"},children:[e.jsx(u.Button,{className:"actionButton",kind:"destructive",density:"high",onClick:w,name:"close",children:"Close"}),e.jsx(u.Button,{className:"actionButton",kind:"outline",density:"high",onClick:B,name:"reset",children:"Reset"}),e.jsx(u.Button,{className:"actionButton",kind:"outline",density:"high",disabled:!l,onClick:y,name:"apply",children:"Apply"}),e.jsx(u.Button,{className:"actionButton",kind:"primary",density:"high",disabled:!l,onClick:y,name:"save",children:"Apply & Close"})]})]})}k.createRoot(document.getElementById("root")).render(e.jsx(c.StrictMode,{children:e.jsx(A,{})}));
