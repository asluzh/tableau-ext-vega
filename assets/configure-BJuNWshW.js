import{l as i}from"./logger-BcLytKeK.js";import{r as p,j as t,t as r,l as m,c as F}from"./vendor-CAmHtlJc.js";function J(n){const[o,g]=p.useState(n.sheet);p.useEffect(()=>{i.debug("useEffect props",n),g(n.sheet)},[n]);function h(a){g(a.target.value),n.updateSheet(a.target.value)}return t.jsx("div",{style:{marginTop:20,marginBottom:20},children:t.jsxs(r.DropdownSelect,{kind:"outline",label:"Select Data Source Sheet",value:o,onChange:h,style:o?{}:{border:"1px solid red"},children:[t.jsx("option",{value:"",children:"Please select..."},""),n.sheets.map(a=>t.jsx("option",{value:a.name,children:a.name},a.name))]})})}function T(n){const[o,g]=p.useState(n.spec),h=p.useMemo(()=>{try{m.parse(o.replace(/(\r|\n)/g,""))}catch(l){return`Invalid input: ${l.message}`}return"Valid input"},[o]);function a(l){g(l.target.value),n.updateJsonSpec(l.target.value)}async function d(l){try{let u=m.parse(o.replace(/(\r|\n)/g,"")),c=null;l.target.name==="json5"?c=m.stringify(u,null,2):c=JSON.stringify(u,null,2),g(c),n.updateJsonSpec(c)}catch(u){i.error("Error in JSON:",u.message)}}return t.jsxs("div",{style:{marginTop:20,marginBottom:20},children:[t.jsx(r.TextArea,{style:{width:"530px",height:"350px",whiteSpace:"pre-wrap",fontFamily:"monospace"},spellCheck:!1,wrap:"off",label:"Vega/Vega-Lite Specification",value:o,message:h,placeholder:"Enter your Vega or Vega-Lite specification here in JSON5 format",onChange:a,valid:h==="Valid input"}),t.jsx(r.Button,{className:"actionButton",kind:"outline",density:"high",onClick:d,name:"json",children:"Format JSON"}),t.jsx(r.Button,{className:"actionButton",kind:"outline",density:"high",onClick:d,name:"json5",children:"Format JSON5"})]})}function V(n){const[o,g]=p.useState(n.options),h=p.useMemo(()=>{try{m.parse(o.replace(/(\r|\n)/g,""))}catch(l){return`Invalid input: ${l.message}`}return"Valid input"},[o]);function a(l){g(l.target.value),n.updateEmbedOptions(l.target.value)}async function d(l){try{let u=m.parse(o.replace(/(\r|\n)/g,"")),c=null;l.target.name==="json5"?c=m.stringify(u,null,2):c=JSON.stringify(u,null,2),g(c),n.updateEmbedOptions(c)}catch(u){i.error("Error in JSON:",u.message)}}return t.jsxs("div",{style:{marginTop:20,marginBottom:20},children:[t.jsx(r.TextArea,{style:{width:"530px",height:"350px",whiteSpace:"pre-wrap",fontFamily:"monospace"},spellCheck:!1,wrap:"off",label:"Vega-Embed Options",value:o,message:h,placeholder:"Enter Vega-Embed options here in JSON5 format",onChange:a,valid:h==="Valid input"}),t.jsx(r.Button,{className:"actionButton",kind:"outline",density:"high",onClick:d,name:"json",children:"Format JSON"}),t.jsx(r.Button,{className:"actionButton",kind:"outline",density:"high",onClick:d,name:"json5",children:"Format JSON5"})]})}function I(n){const[o,g]=p.useState(n.mainDivStyle);function h(a){g(a.target.value),n.updateStylingOptions({mainDivStyle:a.target.value})}return t.jsx("div",{style:{marginTop:20,marginBottom:20},children:t.jsx(r.TextArea,{style:{width:"530px",height:"50px",whiteSpace:"pre",fontFamily:"monospace"},spellCheck:!1,wrap:"off",label:"Main Div Style (CSS format)",value:o,placeholder:"Enter CSS-style for main DIV element",onChange:h})})}const D=1;function A(){const[n,o]=p.useState(0),[g,h]=p.useState([]),[a,d]=p.useState({sheet:"",listenerFilterEvent:!1,listenerDataChanged:!0,listenerDashboardLayout:!1,jsonSpec:"{}",embedOptions:'{ "actions": false, "config": {} }',mainDivStyle:"width: 100vw; height: 100vh;"});p.useEffect(()=>{i.debug("useEffect"),tableau.extensions.initializeDialogAsync().then(e=>{i.debug("Initialize Dialog",e),h(tableau.extensions.dashboardContent.dashboard.worksheets);let s=parseInt(tableau.extensions.settings.get("metaVersion"));if(i.debug("Saved meta version",s),s>D){i.warn("Newer meta version detected in settings!");return}s<D&&i.log("Older meta version detected in saved settings, some settings may not be available");let f=tableau.extensions.settings.get("sheet");f&&l(f);let S=tableau.extensions.settings.get("listenerFilterEvent");S&&v(S==="true");let b=tableau.extensions.settings.get("listenerDataChanged");b&&j(b==="true");let x=tableau.extensions.settings.get("listenerDashboardLayout");x&&C(x==="true");let y=tableau.extensions.settings.get("embedOptions");y&&u(y);let w=tableau.extensions.settings.get("jsonSpec");w&&c(w);let k=tableau.extensions.settings.get("mainDivStyle");k&&O({mainDivStyle:k})})},[]);function l(e){i.debug("updateSheet",e),d(s=>({...s,sheet:e}))}function u(e){i.debug("updateEmbedOptions",e),d(s=>({...s,embedOptions:e}))}function c(e){i.debug("updateJsonSpec",e),d(s=>({...s,jsonSpec:e}))}function v(e){i.debug("updateListenerFilterEvent",e),d(s=>({...s,listenerFilterEvent:e}))}function j(e){i.debug("updateListenerDataChanged",e),d(s=>({...s,listenerDataChanged:e}))}function C(e){i.debug("updateListenerDashboardLayout",e),d(s=>({...s,listenerDashboardLayout:e}))}function O(e){i.debug("updateStylingOptions",e),d(s=>({...s,mainDivStyle:e.mainDivStyle}))}function N(){if(!a.sheet)return i.warn("Sheet variable is empty"),!1;try{m.parse(a.embedOptions.replace(/(\r|\n)/g,""))}catch(e){return i.warn("Invalid embedOptions",e),!1}try{m.parse(a.jsonSpec.replace(/(\r|\n)/g,""))}catch(e){return i.warn("Invalid jsonSpec",e),!1}return!0}function E(e){i.debug("saveSettings",e),N()&&tableau.extensions.environment.mode==="authoring"&&(tableau.extensions.settings.set("metaVersion",D),Object.entries(a).forEach(([s,f])=>{tableau.extensions.settings.set(s,f)}),tableau.extensions.settings.saveAsync().then(()=>{i.debug("Settings saved"),e.target.name==="save"&&tableau.extensions.ui.closeDialog("Save and close")},s=>{window.alert("Saving settings failed! "+s.toString())}))}function B(e){i.debug("closeSettings",e),tableau.extensions.ui.closeDialog("Close")}function L(e){i.debug("resetSettings",e);let s=tableau.extensions.settings.get("sheet");s&&l(s);let f=tableau.extensions.settings.get("listenerFilterEvent");f&&v(f==="true");let S=tableau.extensions.settings.get("listenerDataChanged");S&&j(S==="true");let b=tableau.extensions.settings.get("listenerDashboardLayout");b&&C(b==="true");let x=tableau.extensions.settings.get("embedOptions");x&&u(x);let y=tableau.extensions.settings.get("jsonSpec");y&&c(y),o(0)}return t.jsxs("div",{children:[t.jsx(r.Tabs,{activation:"automatic",alignment:"left",onTabChange:o,selectedTabIndex:n,tabs:[{content:"Data Input"},{content:"Vega Spec"},{content:"Embed Options"},{content:"Styling"}],children:t.jsxs("div",{className:"configForm",children:[n===0&&t.jsx(J,{sheets:g,sheet:a.sheet,updateSheet:l}),n===0&&t.jsx("div",{style:{width:250,paddingTop:10},children:t.jsx(r.ToggleSwitch,{textAlign:"left",checked:a.listenerFilterEvent,onChange:e=>v(e.target.checked),children:"FilterChanged Listener"})}),n===0&&t.jsx("div",{style:{width:250,paddingTop:10},children:t.jsx(r.ToggleSwitch,{textAlign:"left",checked:a.listenerDataChanged,onChange:e=>j(e.target.checked),children:"SummaryDataChanged Listener"})}),n===0&&t.jsx("div",{style:{width:250,paddingTop:10},children:t.jsx(r.ToggleSwitch,{textAlign:"left",checked:a.listenerDashboardLayout,onChange:e=>C(e.target.checked),children:"DashboardLayoutChanged Listener"})}),n===1&&t.jsx(T,{spec:a.jsonSpec,updateJsonSpec:c}),n===2&&t.jsx(V,{options:a.embedOptions,updateEmbedOptions:u}),n===3&&t.jsx(I,{mainDivStyle:a.mainDivStyle,updateStylingOptions:O})]})}),t.jsxs("div",{children:[t.jsx(r.Button,{className:"actionButton",kind:"destructive",density:"high",onClick:B,name:"close",children:"Close"}),t.jsx(r.Button,{className:"actionButton",kind:"outline",density:"high",onClick:L,name:"reset",children:"Reset"}),t.jsx(r.Button,{className:"actionButton",kind:"outline",density:"high",onClick:E,name:"apply",children:"Apply"}),t.jsx(r.Button,{className:"actionButton",kind:"primary",density:"high",onClick:E,name:"save",children:"Apply & Close"})]})]})}F.createRoot(document.getElementById("root")).render(t.jsx(A,{}));
